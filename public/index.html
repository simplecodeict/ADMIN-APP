<!DOCTYPE html>
<html lang="en">

<head>
  <title>Manu Ayurvedaya Inventory Management System</title>

  <!-- Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="description" content="Manu Ayurveda" />
  <meta name="author" content="Xiaoying Riley at 3rd Wave Media" />
  <link rel="shortcut icon" href="assets/images/icon.ico" />

  <!-- FontAwesome JS-->
  <script defer src="assets/plugins/fontawesome/js/all.min.js"></script>


  <!-- App CSS -->
  <link id="theme-style" rel="stylesheet" href="assets/css/portal.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">


  <style>
    /* Center loader and button */
    .loader-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.5);
      /* Semi-transparent gray overlay */
      display: none;
      /* Initially hidden */
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(3px);
      /* Ensure loader is on top */
    }

    .loader-container.active {
      display: flex;
      /* Show loader when active */
    }

    /* Loader styling */
    .loader {
      max-width: 10%;
      /* Adjust size of the loader */
      height: auto;
    }

    /* Center loader within loader container */
    .loader img {
      display: block;
      margin: 0 auto;
    }

    #dateRangePicker {
      padding: 7px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #monthPicker {
      padding: 7px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #weekPicker {
      padding: 7px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .date-time-container {
          position:relative;
          right: 0;
          top: 0;
          padding: 10px;
          font-family: Arial, sans-serif;
          font-weight: 700;
          font-size: 16px;
      }
  </style>

</head>

<body class="app">
  <header class="app-header fixed-top">
    <div class="app-header-inner">
      <div class="container-fluid py-2">
        <div class="app-header-content">
          <div class="row justify-content-between align-items-center">
            <center>
              <div class="date-time-container" id="date-time-container"></div>
            </center>
            <div class="col-auto">
              <a id="sidepanel-toggler" class="sidepanel-toggler d-inline-block d-xl-none" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img">
                  <title>Menu</title>
                  <path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"
                    d="M4 7h22M4 15h22M4 23h22"></path>
                </svg>
              </a>
            </div>
            <div class="search-mobile-trigger d-sm-none col">
              <i class="search-mobile-trigger-icon fa-solid fa-magnifying-glass"></i>
            </div>
            <!-- <div class="app-search-box col">
                <form class="app-search-form">
                  <input
                    type="text"
                    placeholder="Search..."
                    name="search"
                    class="form-control search-input"
                  />
                  <button
                    type="submit"
                    class="btn search-btn btn-primary"
                    value="Search"
                  >
                    <i class="fa-solid fa-magnifying-glass"></i>
                  </button>
                </form>
              </div> -->
          </div>
        </div>
      </div>
    </div>
    <div id="app-sidepanel" class="app-sidepanel">
      <div id="sidepanel-drop" class="sidepanel-drop"></div>
      <div class="sidepanel-inner d-flex flex-column">
        <a href="#" id="sidepanel-close" class="sidepanel-close d-xl-none">&times;</a>
        <div class="app-branding">
          <a class="app-logo" href="index.html"><img style="
                  width: 150px;
                  height: 160px;
                  margin-bottom: 20px;
                  margin-left: 15px;
                  padding-top: 10px;
                " src="assets/images/logo_s.png" alt="logo" /></a>
        </div>
        <!--//app-branding-->

        <nav id="app-nav-main" class="app-nav app-nav-main flex-grow-1" style="margin-top: 120px">
          <ul class="app-menu list-unstyled accordion" id="menu-accordion" style="line-height: 80px">
            <li class="nav-item">
              <a class="nav-link active" href="index.html">
                <span class="nav-icon">
                  <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-house-door" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                      d="M7.646 1.146a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 .146.354v7a.5.5 0 0 1-.5.5H9.5a.5.5 0 0 1-.5-.5v-4H7v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .146-.354l6-6zM2.5 7.707V14H6v-4a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4h3.5V7.707L8 2.207l-5.5 5.5z" />
                    <path fill-rule="evenodd" d="M13 2.5V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z" />
                  </svg>
                </span>
                <span class="nav-link-text">Dashboard</span> </a><!--//nav-link-->
            </li>
            <!--//nav-item-->
            <li class="nav-item">
              <!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
              <a class="nav-link" href="products.html">
                <span class="nav-icon">
                  <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-columns-gap" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                      d="M6 1H1v3h5V1zM1 0a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1H1zm14 12h-5v3h5v-3zm-5-1a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-5zM6 8H1v7h5V8zM1 7a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H1zm14-6h-5v7h5V1zm-5-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1h-5z" />
                  </svg>
                </span>
                <span class="nav-link-text">Products</span> </a><!--//nav-link-->
            </li>
            <!--//nav-item-->
            <li class="nav-item">
              <!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
              <a class="nav-link" href="orders.html">
                <span class="nav-icon">
                  <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-card-list" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                      d="M14.5 3h-13a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z" />
                    <path fill-rule="evenodd"
                      d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z" />
                    <circle cx="3.5" cy="5.5" r=".5" />
                    <circle cx="3.5" cy="8" r=".5" />
                    <circle cx="3.5" cy="10.5" r=".5" />
                  </svg>
                </span>
                <span class="nav-link-text">Orders</span> </a><!--//nav-link-->
            </li>

            <!-- <li class="nav-item">
              <a class="nav-link" href="help.html">
                <span class="nav-icon">
                  <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-question-circle" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                      d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                    <path
                      d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" />
                  </svg>
                </span>
                <span class="nav-link-text">Help</span> </a>
            </li> -->
            <!--//nav-item-->
          </ul>
          <!--//app-menu-->
        </nav>
        <!--//app-nav-->
        <p style="text-align: center; padding: 0px">
          © 2024. Manu Ayurwedaya
        </p>
        <small style="text-align: center; padding-bottom: 20px; margin-top: -10px" class="copyright">Developed by |
          <a class="app-link" href="#">SimpleCodeICT</a>
        </small>
        <div class="app-sidepanel-footer">
          <nav class="app-nav app-nav-footer">
            <ul class="app-menu footer-menu list-unstyled">
              <!--//nav-item-->
              <li class="nav-item">
                <!--//Bootstrap Icons: https://icons.getbootstrap.com/ -->
                <a class="nav-link" href="login.html">
                  <span class="nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                      <path fill-rule="evenodd"
                        d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z" />
                      <path fill-rule="evenodd"
                        d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                    </svg>
                  </span>
                  <span class="nav-link-text">Log Out</span> </a><!--//nav-link-->
              </li>
              <!--//nav-item-->
            </ul>
            <!--//footer-menu-->
          </nav>
        </div>
        <!--//app-sidepanel-footer-->
      </div>
      <!--//sidepanel-inner-->
    </div>
    <!--//app-sidepanel-->
  </header>
  <!--//app-header-->

  <div id="loaderContainer" class="loader-container">
    <!-- GIF Loader -->
    <img src="assets/images/loader.gif" class="loader" alt="Loading GIF">
  </div>

  <div class="app-wrapper">
    <div class="app-content pt-3 p-md-3 p-lg-4">
      <div class="container-xl">
        <div class="row g-3 mb-4 align-items-center justify-content-between">
          <div class="col-auto">
            <h1 class="app-page-title mb-0">Dashboard</h1>
          </div>
          <div class="col-auto">
            <div class="page-utilities">
              <div class="row g-2 justify-content-start justify-content-md-end align-items-center">
                <div class="col-auto">
                  <select class="form-select w-auto" id="shop_for_search">

                  </select>
                </div>
                <div class="col-auto">
                  <input type="month" id="monthPicker" onchange="getSelectedMonthYear(this.value)">
                </div>
                <div class="col-auto">
                  <input type="week" id="weekPicker" onchange="getWeekDates(this.value)">
                </div>
                <div class="col-auto">
                  <input type="text" id="dateRangePicker" placeholder="Select Date Range">
                </div>
                <div class="col-auto" id="date-range">
                  <button class="btn app-btn-secondary" onclick="ClearFilers()">Clear Filters</button>
                </div>
              </div>
              <!--//row-->
            </div>
            <!--//table-utilities-->
          </div>
          <!--//col-auto-->
        </div>

        <style>
          .col-lg-2-4 {
            flex: 0 0 auto;
            width: 20%;
          }
        </style>

        <div class="row g-4 mb-4">
          <div class="col-6 col-lg-2-4">
            <div class="app-card app-card-stat shadow-sm h-100">
              <div class="app-card-body p-3 p-lg-4">
                <h4 class="stats-type mb-1">Total Sales (LKR)</h4>
                <div class="stats-figure" id="totalSales" style="font-weight: 500"></div>
                <div class="stats-meta">All</div>
              </div>
              <!--//app-card-body-->
              <a class="app-card-link-mask" href="#"></a>
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->
          <div class="col-6 col-lg-2-4">
            <div class="app-card app-card-stat shadow-sm h-100">
              <div class="app-card-body p-3 p-lg-4">
                <h4 class="stats-type mb-1">Total Profit (LKR)</h4>
                <div class="stats-figure" id="totalProfit" style="font-weight: 500"></div>
                <div class="stats-meta">All</div>
              </div>
              <!--//app-card-body-->
              <a class="app-card-link-mask" href="#"></a>
            </div>
            <!--//app-card-->
          </div>

          <div class="col-6 col-lg-2-4">
            <div class="app-card app-card-stat shadow-sm h-100">
              <div class="app-card-body p-3 p-lg-4">
                <h4 class="stats-type mb-1">Total Orders</h4>
                <div class="stats-figure" id="totalOrders" style="font-weight: 500"></div>
                <div class="stats-meta">All Orders</div>
              </div>
              <!--//app-card-body-->
              <a class="app-card-link-mask" href="#"></a>
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->

          <div class="col-6 col-lg-2-4">
            <div class="app-card app-card-stat shadow-sm h-100">
              <div class="app-card-body p-3 p-lg-4">
                <h4 class="stats-type mb-1">Total Products</h4>
                <div id="totalProducts" class="stats-figure" style="font-weight: 500"></div>
                <div class="stats-meta">All Products</div>
              </div>
              <!--//app-card-body-->
              <a class="app-card-link-mask" href="#"></a>
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->

          <div class="col-6 col-lg-2-4">
            <div class="app-card app-card-stat shadow-sm h-100">
              <div class="app-card-body p-3 p-lg-4">
                <h4 class="stats-type mb-1">Outlets</h4>
                <div id="totalShops" class="stats-figure" style="font-weight: 500"></div>
                <div class="stats-meta">All</div>
              </div>
              <!--//app-card-body-->
              <a class="app-card-link-mask" href="#"></a>
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->


          <!--//col-->
        </div>
        <!--//row-->

        <!--//row-->

        <!--//row-->
        <div class="row g-4 mb-4">
          <div class="col-12 col-lg-6">
            <div class="app-card app-card-chart h-100 shadow-sm">
              <div class="app-card-header p-3">
                <div class="row justify-content-between align-items-center">
                  <div class="col-auto">
                    <h4 class="app-card-title">Total Weekly Sales Report</h4>
                  </div>
                </div>
              </div>
              <div class="app-card-body p-3 p-lg-4">
                <div class="mb-3 d-flex">
                  <input class="ms-auto d-inline-flex w-auto" type="week" id="weekPicker"
                    onchange="getWeekDates(this.value)">
                </div>
                <div class="chart-container">
                  <canvas id="canvas-linechart"></canvas>
                </div>
              </div>
              <!--//app-card-body-->
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->
          <div class="col-12 col-lg-6">
            <div class="app-card app-card-chart h-100 shadow-sm">
              <div class="app-card-header p-3">
                <div class="row justify-content-between align-items-center">
                  <div class="col-auto">
                    <h4 class="app-card-title">Total Products Report</h4>
                  </div>
                  <!--//col-->
                  <div class="col-auto">
                    <!--//card-header-actions-->
                  </div>
                  <!--//col-->
                </div>
                <!--//row-->
              </div>
              <!--//app-card-header-->
              <div class="app-card-body p-3 p-lg-4">
                <div class="chart-container">
                  <div class="mb-3 d-flex">
                    <input class="ms-auto d-inline-flex w-auto" type="week" id="weekPicker"
                      onchange="getWeekDates(this.value)">
                  </div>
                  <canvas id="canvas-barchart"></canvas>
                </div>
              </div>
              <!--//app-card-body-->
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->
        </div>
        <!--//row-->
        <div class="row g-4 mb-4">

          <!--//col-->
          <div class="col-12 col-lg-12">
            <div class="app-card app-card-stats-table h-100 shadow-sm">
              <div class="app-card-header p-3">
                <div class="row justify-content-between align-items-center">
                  <div class="col-auto">
                    <h4 class="app-card-title">Outlet List</h4>
                  </div>
                  <!--//col-->
                  <div class="col-auto">
                    <!-- <div class="card-header-action">
                        <a href="#">View report</a>
                      </div> -->
                    <!--//card-header-actions-->
                  </div>
                  <!--//col-->
                </div>
                <!--//row-->
              </div>
              <!--//app-card-header-->
              <div class="app-card-body p-3 p-lg-4">
                <div class="table-responsive">
                  <table class="table table-borderless mb-0">
                    <thead>
                      <tr>
                        <th class="meta">Outlet Name</th>
                        <!-- <th class="meta stat-cell">Users</th> -->
                      </tr>
                    </thead>
                    <tbody id="items-table-body">


                    </tbody>
                  </table>
                </div>
                <!--//table-responsive-->
              </div>
              <!--//app-card-body-->
            </div>
            <!--//app-card-->
          </div>
          <!--//col-->
        </div>
        <!--//row-->

        <!--//row-->
      </div>
      <!--//container-fluid-->
    </div>
    <!--//app-content-->
    <!--//app-footer-->
  </div>
  <!--//app-wrapper-->

  <!-- Javascript -->
  <script src="assets/plugins/popper.min.js"></script>
  <script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>

  <!-- Charts JS -->
  <script src="assets/plugins/chart.js/chart.min.js"></script>
  <script src="assets/js/.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- Page Specific JS -->
  <script src="assets/js/app.js"></script>

  <script src="assets/plugins/chart.js/chart.min.js"></script>
  <script src="assets/js/index-charts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="axiosConfig.js"></script>


  <script>
    const loaderContainer = document.getElementById('loaderContainer');
    const tableBody = document.getElementById('items-table-body');
    const shopSelect = document.getElementById('shop_for_search');
    let totalOrders = 0
    let totalSales = 0
    let actualCost = 0
    let filter = {};

    async function fetchOrders(filter = {}) {
      try {
        loaderContainer.classList.add('active');
        let url = '/api/orders?';
        if (filter.shop_id) url += `filter[shop_id]=${filter.shop_id}&`
        if (filter.month) url += `filter[month]=${filter.month}&`;
        if (filter.week) url += `filter[week]=${filter.week}&`;
        if (filter.date) url += `filter[date]=${filter.date}&`;
        url += `per_page=${10000}`;

        const response = (await AxiosInstance.get(url)).data.data;
        console.log(response)

        totalSales = 0
        actualCost = 0
        response.forEach((x) => {
          totalSales = totalSales + x.total_selling_price * 1
          actualCost = actualCost + x.total_actual_price * 1
        })

        const totalSalesCard = document.querySelector('.stats-figure');
        const profitCard = document.querySelector('#totalProfit');
        const totalOrdersCard = document.querySelector('#totalOrders');

        totalSalesCard.textContent = '';
        totalOrdersCard.textContent = '';
        profitCard.textContent = '';

        const totalSalesElemt = document.createTextNode(totalSales.toFixed(2));
        const totalOrdersElement = document.createTextNode(response.length);
        const totalProfitElement = document.createTextNode((totalSales.toFixed(2) - actualCost.toFixed(2)).toFixed(2))

        totalSalesCard.appendChild(totalSalesElemt);
        totalOrdersCard.appendChild(totalOrdersElement)
        profitCard.appendChild(totalProfitElement)
      } catch (error) {
        Toastify({
          text: `❌ ${error.message}`,
          duration: 5000,
          destination: "https://github.com/apvarun/toastify-js",
          newWindow: true,
          close: true,
          gravity: "top", // `top` or `bottom`
          position: "right", // `left`, `center` or `right`
          stopOnFocus: true, // Prevents dismissing of toast on hover
          style: {
            background: "#333", // Dark background color
            color: "#fffff", // Red text color for error
            boxShadow: "0 0 10px rgba(0, 0, 0, 0.5)", // Slight shadow for depth
            padding: "16px", // Additional padding for better readability
            borderRadius: "8px" // Rounded corners
          },
          onClick: function () { } // Callback after click
        }).showToast();
        console.error('Error fetching orders:', error);
      } finally {
        loaderContainer.classList.remove('active');
      }
    }

    const fp = flatpickr("#dateRangePicker", {
      mode: "range", // Enable date range selection
      dateFormat: "Y-m-d", // Date format
      onClose: function (selectedDates, dateStr, instance) {
        // Callback function to handle date range selection
        if (selectedDates.length > 0) {
          const startDate = selectedDates[0];
          const endDate = selectedDates[selectedDates.length - 1];

          // Format dates to YYYY-MM-DD
          const startDateFormatted = formatDate(startDate);
          const endDateFormatted = formatDate(endDate);

          console.log("Start Date:", startDateFormatted);
          console.log("End Date:", endDateFormatted);

          filter.date = `${startDateFormatted},${endDateFormatted}`;

          fetchOrders(filter);
        }
      }
    });

    function ClearFilers() {
      fp.clear();
      document.getElementById("weekPicker").value = "";
      document.getElementById("weekPicker").value = "";
      document.getElementById("monthPicker").value = "";
      document.getElementById('shop_for_search').value = ""
      fetchOrders();
    }

    function formatDate(dateString) {
      const date = new Date(dateString);

      // Extract year, month, and day from the Date object
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based, so January is 0
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    async function fetchProducts() {
      try {
        let url = '/api/items/all-items?';
        loaderContainer.classList.add('active');

        const response = (await AxiosInstance.get(url)).data;

        const totalProducts = document.querySelector('#totalProducts');
        const totalProductsElement = document.createTextNode(response.length);
        totalProducts.appendChild(totalProductsElement)


        console.log(response)
      } catch (error) {
        Toastify({
          text: `❌ ${error.message}`,
          duration: 5000,
          destination: "https://github.com/apvarun/toastify-js",
          newWindow: true,
          close: true,
          gravity: "top", // `top` or `bottom`
          position: "right", // `left`, `center` or `right`
          stopOnFocus: true, // Prevents dismissing of toast on hover
          style: {
            background: "#333", // Dark background color
            color: "#fffff", // Red text color for error
            boxShadow: "0 0 10px rgba(0, 0, 0, 0.5)", // Slight shadow for depth
            padding: "16px", // Additional padding for better readability
            borderRadius: "8px" // Rounded corners
          },
          onClick: function () { } // Callback after click
        }).showToast();
        console.error('Error fetching orders:', error);
      } finally {
        loaderContainer.classList.remove('active');
      }
    }

    async function fetchShops() {
      try {
        let url = '/api/shops?';
        loaderContainer.classList.add('active');

        shopSelect.innerHTML = '';

        const option1 = document.createElement('option');

        option1.value = '';
        option1.textContent = 'Select shop';
        shopSelect.appendChild(option1);
        const response = (await AxiosInstance.get(url)).data;


        let rows = '';

        const totalShp = document.querySelector('#totalShops');
        const totalShopsElement = document.createTextNode(response.length);
        totalShp.appendChild(totalShopsElement)

        response.forEach((item, index) => {
          const option1 = document.createElement('option');

          option1.value = item.id;
          option1.textContent = item.name + " - " + item.branch;


          // Set the 'selected' attribute for the default option
          if (item.id === '') {
            option1.selected = true;
          }
          shopSelect.appendChild(option1);
          rows += `
											<tr>
												<td style="color: #0da538">${item.name + `(${item.branch})`}</td>
											</tr>
										`;
        });
        tableBody.innerHTML = rows;
        // displayCart2(response)

      } catch (error) {
        Toastify({
          text: `❌ ${error.message}`,
          duration: 5000,
          destination: "https://github.com/apvarun/toastify-js",
          newWindow: true,
          close: true,
          gravity: "top", // `top` or `bottom`
          position: "right", // `left`, `center` or `right`
          stopOnFocus: true, // Prevents dismissing of toast on hover
          style: {
            background: "#333", // Dark background color
            color: "#fffff", // Red text color for error
            boxShadow: "0 0 10px rgba(0, 0, 0, 0.5)", // Slight shadow for depth
            padding: "16px", // Additional padding for better readability
            borderRadius: "8px" // Rounded corners
          },
          onClick: function () { } // Callback after click
        }).showToast();
        console.error('Error fetching orders:', error);
      } finally {
        loaderContainer.classList.remove('active');
      }
    }

    function updateChart1(data) {
      console.log(data)
      // Initialize an empty object to hold the results
      const weeklySalesByShop = {};

      // Function to get the day of the week from a date
      function getDayOfWeek(dateString) {
        const date = new Date(dateString);
        console.log(date)

        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        return days[date.getUTCDay()];
      }

      // Process each order
      data.forEach(order => {
        const shopName = `${order.shop.name} - ${order.shop.branch}`;
        const dayOfWeek = getDayOfWeek(order.created_at);
        const totalPrice = parseFloat(order.total_price);

        // Initialize the shop in the result object if not already present
        if (!weeklySalesByShop[shopName]) {
          weeklySalesByShop[shopName] = {};
        }

        // Initialize the day of the week for the shop if not already present
        if (!weeklySalesByShop[shopName][dayOfWeek]) {
          weeklySalesByShop[shopName][dayOfWeek] = 0;
        }

        // Add the total price to the appropriate day and shop
        weeklySalesByShop[shopName][dayOfWeek] += totalPrice;
      });

      console.log(weeklySalesByShop, "weeklySalesByShop")
      // Log the results
    }

   
    function getSelectedMonthYear(selectedDate) {
      // Output format: YYYY-MM
      console.log(selectedDate)
      filter.month = selectedDate
      fetchOrders(filter);
    }

    document.getElementById('shop_for_search').addEventListener('change', (e) => {
      filter.shop_id = e.target.value;
      fetchOrders(filter)

    });
    // week filter
    function getWeekDates(selectedWeek) {
      const year = selectedWeek.substring(0, 4); // Extract year from YYYY-Www
      const weekNumber = selectedWeek.substring(6); // Extract week number from YYYY-Www

      // Calculate start date (Monday) of the selected week
      const startDate = new Date(year, 0, 1 + (weekNumber - 1) * 7); // January 1st + 7 days per week number

      // Adjust start date to Monday of the selected week
      startDate.setDate(startDate.getDate() - startDate.getDay() + 1);

      // Calculate end date (Sunday) of the selected week
      const endDate = new Date(startDate);
      endDate.setDate(endDate.getDate() + 6); // End date is the Sunday of the same week

      // Format dates for display
      const formattedEndDate = endDate.toISOString().split('T')[0];


      filter.week = formattedEndDate

      fetchOrders(filter)
    }
    document.addEventListener('DOMContentLoaded', () => {
      // const currentDate = new Date();
      // const currentMonth = currentDate.getMonth() + 1; // Months are zero-based, so add 1
      // const formattedMonth = currentMonth < 10 ? '0' + currentMonth : currentMonth; // Ensure two-digit format
      // const currentYear = currentDate.getFullYear();
      // const currentMonthYear = `${currentYear}-${formattedMonth}`;

      // document.getElementById('monthPicker').value = currentMonthYear;

      // filter.month = currentMonthYear

      fetchOrders();
      fetchProducts();
      fetchShops();

    });

    function updateDateTime() {
          const dateTimeContainer = document.getElementById('date-time-container');
          const now = new Date();

          const hours = now.getHours();
          const minutes = now.getMinutes();
          const seconds = now.getSeconds();
          const ampm = hours >= 12 ? 'PM' : 'AM';

          const formattedTime = `${hours % 12 || 12}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')} ${ampm}`;

          const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

          const day = days[now.getDay()];
          const date = now.getDate();
          const month = months[now.getMonth()];
          const year = now.getFullYear();

          const formattedDate = `${date}${getOrdinalSuffix(date)} ${month} ${year}`;

          dateTimeContainer.innerHTML = `${formattedTime} | ${formattedDate}`;
      }

      function getOrdinalSuffix(n) {
          const s = ["th", "st", "nd", "rd"];
          const v = n % 100;
          return s[(v - 20) % 10] || s[v] || s[0];
      }

      setInterval(updateDateTime, 1000);
      updateDateTime(); // Initial call to set date and time immediately
  </script>
</body>

</html>